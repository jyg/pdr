#N canvas 486 101 1136 704 10;
#N canvas 358 110 228 134 phase-tables 0;
#X obj 22 19 table \$0-prev-real 4096;
#X obj 20 42 table \$0-prev-imag 4096;
#X restore 487 456 pd phase-tables;
#N canvas 0 110 565 454 hann-window 0;
#N canvas 0 50 450 300 (subpatch) 0;
#X array \$0-hann 1024 float 0;
#X coords 0 1 1023 0 300 100 1;
#X restore 82 311 graph;
#X obj 378 165 osc~;
#X obj 378 190 *~ -0.5;
#X obj 378 214 +~ 0.5;
#X obj 331 247 tabwrite~ \$0-hann;
#X obj 38 173 /;
#X obj 127 142 samplerate~;
#X obj 177 204 swap;
#X obj 177 228 /;
#X obj 49 201 * 1000;
#X obj 38 115 t f b f;
#X msg 173 92 resize \$1;
#X obj 173 116 s \$0-hann;
#X msg 382 130 0;
#X obj 330 131 t f b;
#X text 15 8 calculate Hann window table (variable window size) and
constants window-hz (fundamental frequency of analysis) \, window-sec
and window-msec (analysis window size in seconds and msec).;
#X obj 37 88 r \$0-window-size;
#X obj 49 228 s \$0-window-msec;
#X obj 38 251 s \$0-window-sec;
#X obj 177 252 s \$0-window-hz;
#X obj 330 105 r \$0-window-hz;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 9 0;
#X connect 5 0 18 0;
#X connect 6 0 5 1;
#X connect 6 0 7 1;
#X connect 7 0 8 0;
#X connect 7 1 8 1;
#X connect 8 0 19 0;
#X connect 9 0 17 0;
#X connect 10 0 5 0;
#X connect 10 0 7 0;
#X connect 10 1 6 0;
#X connect 10 2 11 0;
#X connect 11 0 12 0;
#X connect 13 0 1 1;
#X connect 14 0 1 0;
#X connect 14 1 4 0;
#X connect 14 1 13 0;
#X connect 16 0 10 0;
#X connect 20 0 14 0;
#X restore 487 480 pd hann-window;
#X msg 654 259 512;
#X msg 654 281 1024;
#X msg 654 303 2048;
#X msg 654 325 4096;
#X text 654 226 window size \,;
#X text 654 241 samples;
#X text 695 258 <- set;
#X text 707 371 (check);
#X obj 345 247 s \$0-location;
#N canvas 265 50 821 693 fft-analysis 0;
#X obj 51 477 *~;
#X obj 18 477 *~;
#X obj 18 499 -~;
#X obj 167 475 *~;
#X obj 136 475 *~;
#X obj 136 497 +~;
#X obj 127 379 *~;
#X obj 238 430 rfft~;
#X obj 19 564 rifft~;
#X obj 21 646 outlet~;
#X obj 97 379 *~;
#X obj 97 401 +~;
#X obj 18 431 *~;
#X obj 51 432 *~;
#X obj 426 644 block~;
#X obj 19 349 +~ 1e-15;
#X obj 19 598 *~;
#X obj 52 598 tabreceive~ \$0-hann;
#X msg 426 619 set \$1 4;
#X obj 97 425 q8_rsqrt~;
#X text 272 5 recall previous output amplitude. Its phase will be added
to the phase difference we measure from two windows in the the recorded
sound.;
#X obj 19 325 +~;
#X obj 125 331 +~;
#X text 247 66 divide by the magnitude to make a unit-magnitude complex
amplitude (phase only). The 1e-20 is to prevent overflows. q8_rsqrt~
is reciprocal square root.;
#X text 247 165 Take FT of the window in back. Multiply its conjugate
by the normalized previous output. The result has the magnitude of
the input sound and phase (previous output phase) minus (back window
phase).;
#X text 249 370 Normalize again \, this time taking care to salt each
channel with 1e-15 so that we get a unit complex number even if everything
was zero heretofore.;
#X text 288 427 Now take the FT of the forward window and multiply
it by the unit complex number from above. The magnitude will be that
of the forward window and the phase will be the previous output phase
plus the phase difference between the two analysis windows -- except
that if "lock" is on \, they will be modified to agree progressively
better with the inter-channel phase relationships of the input.;
#X text 249 242 If "lock" is on \, encourage neighboring channels to
stay in phase by adding the two neighboring complex amplitudes. The
result will tend toward the channel with the strongest amplitude. If
the phase relationships between channels in the output and those in
the input are in parallel \, then neighboring channels of the quotient
will all have the same phase and this will not change any phases. (lrshift
shifts the signal to the left or right depending on its argument.)
;
#X text 387 560 'set' message to block;
#X text 390 577 allows variable size;
#X text 259 126 Read two windows \, one 1/4 length behind the other
\, of the input sound \, with Hann window function (see inside).;
#X obj 21 622 *~;
#X obj 21 215 +~;
#X obj 126 221 -~;
#X obj 109 193 *~;
#X obj 78 193 *~;
#X obj 50 193 *~;
#X obj 19 193 *~;
#X obj 108 161 rfft~;
#N canvas 123 -20 1263 724 read-windows 0;
#X obj 18 693 *~;
#X obj 156 300 f;
#X obj 102 139 /;
#X obj 195 695 *~;
#X obj 142 266 bang~;
#X obj 17 551 line~;
#X obj 102 164 * 1000;
#X obj 183 470 +;
#X obj 143 446 t f f;
#X msg 17 523 \$1 \, \$2 \$3;
#X obj 17 496 pack 0 0 0;
#X obj 178 371 / 1000;
#X obj 156 394 *;
#X text 188 394 reading location (samples);
#X obj 51 597 / 4;
#X floatatom 364 498 7 0 0 0 - - -;
#X obj 364 474 *;
#X obj 502 369 * 0.01;
#X obj 504 390 + 69;
#X obj 505 411 mtof;
#X obj 505 433 / 440;
#X obj 399 474 t b f;
#X obj 19 719 outlet~;
#X obj 195 720 outlet~;
#X obj 218 664 tabreceive~ \$0-hann;
#X text 432 498 stretched window size (samples);
#X obj 178 347 r \$0-insamprate;
#X floatatom 111 187 5 0 0 0 - - -;
#X obj 102 115 t f b;
#X obj 142 139 samplerate~;
#X obj 102 208 / 4;
#X obj 193 420 / 2;
#X obj 156 420 -;
#X text 229 417 back up 1/2 window;
#X obj 16 597 -~;
#X text 43 6 Read two windows out of the recorded sample \, one 1/4
ahead of the other. The mid point of the front window is specified
by "location". If "speed" is nonzero \, "location" automatically precesses.
;
#X text 91 587 "back" window 1/4 cycle behind "front" one;
#X text 137 205 computation period (msec) for overlap of 4;
#X text 164 186 msec in a window;
#X obj 593 457 t b f;
#X obj 617 395 samplerate~;
#X obj 593 348 r \$0-insamprate;
#X obj 593 418 /;
#X obj 505 455 * 1;
#X text 494 312 desired transposition and sample;
#X text 494 329 rate correction for soundfile;
#X obj 593 370 t f b;
#X obj 209 237 r \$0-location;
#X obj 502 347 r \$0-transpo;
#X obj 102 91 r \$0-window-size;
#X obj 364 448 r \$0-window-size;
#X obj 705 455 r \$0-setarray;
#X msg 705 476 set \$1;
#X floatatom 209 258 5 0 0 0 - - -;
#X msg 534 214;
#X floatatom 502 204 5 0 0 0 - - -;
#X obj 777 335 r \$0-shift;
#X obj 17 637 tabread4~ \$1;
#X obj 194 637 tabread4~ \$1;
#X floatatom 103 419 5 0 0 0 - - -;
#X connect 0 0 22 0;
#X connect 1 0 12 0;
#X connect 2 0 6 0;
#X connect 3 0 23 0;
#X connect 4 0 1 0;
#X connect 5 0 34 0;
#X connect 5 0 58 0;
#X connect 6 0 27 0;
#X connect 6 0 30 0;
#X connect 7 0 10 1;
#X connect 8 0 10 0;
#X connect 8 1 7 0;
#X connect 9 0 5 0;
#X connect 10 0 9 0;
#X connect 11 0 12 1;
#X connect 12 0 32 0;
#X connect 12 0 59 0;
#X connect 14 0 34 1;
#X connect 15 0 14 0;
#X connect 15 0 7 1;
#X connect 15 0 31 0;
#X connect 16 0 15 0;
#X connect 17 0 18 0;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 20 0 43 0;
#X connect 21 0 16 0;
#X connect 21 1 16 1;
#X connect 24 0 3 1;
#X connect 24 0 0 1;
#X connect 26 0 11 0;
#X connect 28 0 2 0;
#X connect 28 1 29 0;
#X connect 29 0 2 1;
#X connect 30 0 10 2;
#X connect 31 0 32 1;
#X connect 32 0 8 0;
#X connect 34 0 57 0;
#X connect 39 0 43 0;
#X connect 39 1 43 1;
#X connect 40 0 42 1;
#X connect 41 0 46 0;
#X connect 42 0 39 0;
#X connect 43 0 21 0;
#X connect 46 0 42 0;
#X connect 46 1 40 0;
#X connect 47 0 1 1;
#X connect 47 0 53 0;
#X connect 48 0 17 0;
#X connect 49 0 28 0;
#X connect 50 0 16 0;
#X connect 51 0 52 0;
#X connect 52 0 57 0;
#X connect 52 0 58 0;
#X connect 56 0 43 0;
#X connect 57 0 0 0;
#X connect 58 0 3 0;
#X restore 109 133 pd read-windows;
#X obj 121 69 *~;
#X obj 89 69 *~;
#X obj 89 91 +~;
#X obj 159 94 q8_rsqrt~;
#X obj 159 71 +~ 1e-20;
#X obj 73 119 *~;
#X obj 19 118 *~;
#X obj 46 289 *~;
#X obj 159 312 *~;
#X obj 266 605 * 3;
#X msg 261 635 2 \$1;
#X obj 313 647 /;
#X obj 20 8 tabreceive~ \$0-prev-real;
#X obj 73 29 tabreceive~ \$0-prev-imag;
#X obj 137 543 tabsend~ \$0-prev-imag;
#X obj 136 567 tabsend~ \$0-prev-real;
#X obj 182 274 r \$0-lock;
#X obj 55 234 lrshift~ 1;
#X obj 37 257 lrshift~ -1;
#X obj 161 245 lrshift~ 1;
#X obj 153 269 lrshift~ -1;
#X obj 426 595 r \$0-window-size;
#X obj 273 577 r \$0-window-size;
#X floatatom 313 598 5 0 0 0 - - -;
#X connect 0 0 2 1;
#X connect 1 0 2 0;
#X connect 2 0 8 0;
#X connect 2 0 55 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 5 0 8 1;
#X connect 5 0 54 0;
#X connect 6 0 11 1;
#X connect 7 0 1 1;
#X connect 7 0 3 1;
#X connect 7 1 0 1;
#X connect 7 1 4 1;
#X connect 8 0 16 0;
#X connect 10 0 11 0;
#X connect 11 0 19 0;
#X connect 12 0 1 0;
#X connect 12 0 4 0;
#X connect 13 0 0 0;
#X connect 13 0 3 0;
#X connect 15 0 10 1;
#X connect 15 0 10 0;
#X connect 15 0 12 0;
#X connect 16 0 31 0;
#X connect 17 0 16 1;
#X connect 18 0 14 0;
#X connect 19 0 12 1;
#X connect 19 0 13 1;
#X connect 21 0 15 0;
#X connect 22 0 6 0;
#X connect 22 0 6 1;
#X connect 22 0 13 0;
#X connect 31 0 9 0;
#X connect 32 0 21 0;
#X connect 32 0 57 0;
#X connect 32 0 58 0;
#X connect 33 0 22 0;
#X connect 33 0 59 0;
#X connect 33 0 60 0;
#X connect 34 0 33 1;
#X connect 35 0 33 0;
#X connect 36 0 32 1;
#X connect 37 0 32 0;
#X connect 38 0 37 1;
#X connect 38 0 35 1;
#X connect 38 1 34 1;
#X connect 38 1 36 1;
#X connect 39 0 38 0;
#X connect 39 1 7 0;
#X connect 40 0 42 1;
#X connect 41 0 42 0;
#X connect 42 0 44 0;
#X connect 43 0 45 1;
#X connect 43 0 46 1;
#X connect 44 0 43 0;
#X connect 45 0 36 0;
#X connect 45 0 35 0;
#X connect 46 0 37 0;
#X connect 46 0 34 0;
#X connect 47 0 21 1;
#X connect 48 0 22 1;
#X connect 49 0 50 0;
#X connect 50 0 51 0;
#X connect 51 0 31 1;
#X connect 52 0 41 1;
#X connect 52 0 41 0;
#X connect 52 0 46 0;
#X connect 53 0 40 1;
#X connect 53 0 40 0;
#X connect 53 0 45 0;
#X connect 56 0 47 1;
#X connect 56 0 48 1;
#X connect 57 0 47 0;
#X connect 58 0 47 0;
#X connect 59 0 48 0;
#X connect 60 0 48 0;
#X connect 61 0 18 0;
#X connect 62 0 49 0;
#X connect 62 0 63 0;
#X restore 836 308 pd fft-analysis;
#X obj 352 102 inlet control;
#X msg 280 457 locking \$1;
#X msg 99 447 setarray sample;
#X msg 380 302 transients 0 6227 35716 53368;
#X msg 380 324 notransients;
#X obj 135 395 s \$0-setarray;
#X obj 139 221 symbol;
#X obj 49 284 loadbang;
#X obj 49 305 list append \$1;
#X obj 49 326 route float;
#X obj 39 233 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 654 347 s \$0-window-size;
#X obj 830 206 loadbang;
#X obj 830 227 list append \$2;
#X obj 268 236 s \$0-lock;
#X obj 836 329 outlet~;
#X text 349 190 location(ms);
#X msg 684 384;
#X floatatom 653 465 5 0 0 0 - - -;
#X obj 652 517 s \$0-transpo;
#X obj 564 195 s \$0-insamprate;
#X msg 559 172 44100;
#X obj 597 103 loadbang;
#X obj 477 247 s \$0-shift;
#X obj 187 152 route setarray locking location_ms transpo insamprate
pitch;
#X obj 464 192 bang~;
#X floatatom 528 202 5 0 0 0 - - -;
#X obj 471 220 f 1;
#X connect 2 0 23 0;
#X connect 3 0 23 0;
#X connect 4 0 23 0;
#X connect 5 0 23 0;
#X connect 11 0 27 0;
#X connect 12 0 36 0;
#X connect 18 0 17 0;
#X connect 19 0 20 0;
#X connect 20 0 21 0;
#X connect 21 1 17 0;
#X connect 22 0 20 0;
#X connect 24 0 25 0;
#X connect 25 0 23 0;
#X connect 30 0 31 0;
#X connect 33 0 32 0;
#X connect 34 0 33 0;
#X connect 36 0 18 0;
#X connect 36 1 26 0;
#X connect 36 2 10 0;
#X connect 36 3 31 0;
#X connect 36 4 32 0;
#X connect 36 5 39 1;
#X connect 37 0 39 0;
#X connect 38 0 39 1;
#X connect 39 0 35 0;
